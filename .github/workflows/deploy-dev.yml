name: Deploy to GitHub Pages (Dev)

on:
  push:
    branches:
      # - main
      # - translation
      - new-tool

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  deploy-to-pages:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
          cache: "pip"
          cache-dependency-path: "pyproject.toml"

      - name: 👷‍ init and preprocessing
        shell: bash
        run: |
          pip install --upgrade pip setuptools wheel
          pip install invoke pdm
          

      - name: Site initialization
        run: |
          invoke virtualenv
          invoke run -t update-downloads
          invoke run -t update-docs

      - name: 🔧 Build HTML
        run: |
          invoke doc.clean
          invoke doc
          invoke intl -l zh_CN, de_DE
          invoke run -t post-process

      - name: Setup Pages
        uses: actions/configure-pages@main
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          # Upload entire repository
          path: 'output/'
      - name: 🚀 Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@main

      # - name: 🚀 Deploy to GitHub pages
      #   uses: peaceiris/actions-gh-pages@v3.6.1
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}
      #     publish_dir: output/

